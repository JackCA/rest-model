!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.RestModel=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("./lib/cache"),d=a("./lib/utils"),e=Ember.Object.extend({assignErrors:function(){},attrs:function(){return[]}.property(),init:function(){var a=this;this.setOriginalProperties();var b=Ember.computed.apply(Ember,this.get("attrs").concat(function(b,c){var d,e=a.get("attrs"),f=a.get("originalProperties");for(d=0;d<e.length;d++)if(b=e[d],c=a.get(b),c!==f.get(b))return!0;return!1}));Ember.defineProperty(this,"isDirty",b)},"delete":function(a){return this.submit("delete",a)},errors:function(){return[]}.property(),fetch:function(){var a=this.get("parentKeys"),b=this.getPrimaryKey();return this.constructor.find(a,b).then(function(a){return this.setProperties(a),this}.bind(this))},getParentKeys:function(){return this.parents?this.parents.map(function(a){return"number"==typeof a||"string"==typeof a?a:a.getPrimaryKey()}):[]},getPrimaryKey:function(){for(var a,b,c=this.constructor.primaryKeys,d=0;d<c.length;d++)if(a=c[d],b=this.get(a),"undefined"!=typeof b&&null!==b)return b},isPersisted:function(){var a=this.get("created_at");return"undefined"!=typeof a&&null!==a}.property("created_at"),pick:function(a){var b=this;return a.reduce(function(a,c){return a[c]=b.get(c),a},{})},revert:function(){return this.setProperties(this.get("originalProperties"))},save:function(a){var b,c=this;return b=this.get("isPersisted")?"patch":"post",this.submit(b,a).then(function(){return c.setOriginalProperties()})},setOriginalProperties:function(){var a=this,b=this.get("attrs");this.set("originalProperties",Ember.keys(this).reduce(function(c,d){return-1===b.indexOf(d)?c:c.set(d,Ember.copy(a[d],!0))},Ember.Object.create()))},serialize:function(){if(void 0!==this.get("serializedProperties")&&null!==this.get("serializedProperties")){var a=this.pick(this.get("serializedProperties"));return JSON.stringify(a)}return JSON.stringify(this)},submit:function(a,b){var c=this.getParentKeys(),d=this;return"delete"===a?this.set("isDeleting",!0):this.set("isSaving",!0),new Ember.RSVP.Promise(function(e,f){d.constructor[a](c,d,b).then(function(a){d.get("errors").setObjects([]),d.setProperties(a),e(d)},function(a){d.assignErrors(a),f(a)}).finally(function(){"delete"===a?d.set("isDeleting",!1):d.set("isSaving",!1)})})}}).reopenClass({ajax:function(a){var b,d=this,e=a.method||"GET",f=this.getCacheKey(a);return a.hasOwnProperty("cache")||(a.cache=this.cache),new Ember.RSVP.Promise(function(g,h){var i;a.cache&&(b=c.getModels(d,f))&&(i=d.processResponse(b,a),g(i)),$.ajax({url:a.url,type:e,data:a.data,beforeSend:d.getBeforeSend(a),dataType:"json",contentType:"application/json"}).then(function(b){var h=d.processResponse(b,a);a.cache&&"GET"===e&&b&&c.update(d,f,b),i?d.updateCachedResponse(i,h):g(h)},function(a){delete a.then,h(a)})})},all:function(a,b){var c=this.extractPrimaryKeys(a),d=this.buildURL(c,null,b);return b=$.extend({url:d,parents:a},b),this.ajax(b)},buildURL:function(a,b,c){var d;c=c||{},d=c.withURL?c.withURL:this.url;var f=Ember.String.fmt(d.replace(/:[^\/]+/g,"%@"),a),g=this.namespace||e.namespace;return g=g?"/"+g:"",Ember.isBlank(b)||(f=[f,b].join("/")),g+f},"delete":function(a,b,c){var d=this.extractPrimaryKeys(a),e=this.buildURL(d,b.getPrimaryKey(),c);return this.ajax({url:e,method:"DELETE"})},deserializeArray:function(a){var b=this;return $.map(a,function(a){return b.deserialize(a)})},deserialize:function(a){return this.create(a)},extractPrimaryKeys:function(a){return Ember.makeArray(a).map(function(a){return"number"==typeof a||"string"==typeof a?a:a.getPrimaryKey()})},find:function(a,b){("number"==typeof a||"string"==typeof a)&&(b=a,a=void 0);var c=this.extractPrimaryKeys(a),d=this.buildURL(c,b);return this.ajax({url:d,parents:a})},getBeforeSend:function(){return function(){}},getCacheKey:function(a){var b=a.method||"GET";return"%@: %@ - %@".fmt(this.toString(0),b,a.url)},namespace:null,objectToArray:function(a){var b=[];return Object.keys(a).forEach(function(c){b.push({key:c,value:a[c]})}),b},patch:function(a,b,c){var d=this.extractPrimaryKeys(a),e=this.buildURL(d,b.getPrimaryKey(),c),f=b.serialize("patch");return this.ajax({url:e,method:"PATCH",data:f})},post:function(a,b,c){var d=this.extractPrimaryKeys(a),e=this.buildURL(d,null,c),f=b.serialize("post");return this.ajax({url:e,method:"POST",data:f})},primaryKeys:["id"],processResponse:function(a,b){return this.forceArray&&(a=this.objectToArray(a)),a=$.isArray(a)?this.deserializeArray(a):this.deserialize(a),b.parents&&Ember.makeArray(a).forEach(function(a){a.set("parents",Ember.makeArray(b.parents))}),a},updateCachedResponse:function(a,b){var c=this;$.isArray(a)?(a.forEach(function(e){return d.findMatching(e,c,b)?void 0:a.removeObject(e)}),b.forEach(function(b){var e=d.findMatching(b,c,a);return e?e.setProperties(b):a.pushObject(b)})):a.setProperties(b)}});"function"==typeof a&&b&&(b.exports=e)},{"./lib/cache":2,"./lib/utils":3}],2:[function(a,b,c){"use strict";function d(a,b,c){e.findMatching(a,b,c)||c.push(a)}var e=a("./utils");c.get=function(a){var b=localStorage.getItem(a)||null;return JSON.parse(b)},c.set=function(a,b){var c=JSON.stringify(b);return localStorage.setItem(a,c)},c.getModels=function(a,b){var c=this.get(a),d=a.primaryKeys[0],e=this.get(b);return c?$.isArray(e)?c.filter(function(a){return e.contains(a[d])}):c.find(function(a){return a[d]===e}):null},c.update=function(a,b,c){var d,e=a.primaryKeys[0];this.updateClassStore(a,c),d=$.isArray(c)?c.map(function(a){return a[e]}):c[e],this.set(b,d)},c.updateClassStore=function(a,b){var c=this.get(a.toString())||[];return $.isArray(b)?b.forEach(function(b){d(b,a,c)}):d(b,a,c),this.set(a.toString(),c),c}},{"./utils":3}],3:[function(a,b,c){"use strict";function d(a,b){return"function"==typeof a.get?a.get(b):a[b]}c.findMatching=function(a,b,c){var e=b.primaryKeys[0];return c.find(function(b){return d(a,e)===d(b,e)})}},{}]},{},[1])(1)});